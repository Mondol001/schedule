<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>এডমিন ড্যাশবোর্ড</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* Global Styles */
    body {
      font-family: 'Arial', sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }
    form {
      margin-bottom: 20px;
    }
    input, textarea, button, select {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 15px;
    }
    button {
      background: #333;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #555;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 12px;
      text-align: left;
    }
    .message {
      text-align: center;
      margin: 10px 0;
      font-weight: bold;
    }
    .logout {
      text-align: right;
      margin-bottom: 10px;
    }
    .logout button {
      background: #c00;
    }
  </style>
  <!-- Firebase CDN Scripts (v9 compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="container">
    <div class="logout">
      <button id="logoutBtn">লগআউট</button>
    </div>
    <h2>এডমিন ড্যাশবোর্ড: শিডিউল ম্যানেজমেন্ট</h2>
    
    <!-- শিডিউল এন্ট্রি ফর্ম -->
    <form id="scheduleForm">
      <!-- এডিট মোড ট্র্যাক করতে হিডেন ইনপুট -->
      <input type="hidden" id="docId">
      <input type="date" id="scheduleDate" required placeholder="শিডিউল তারিখ">
      <input type="text" id="orderNo" placeholder="অর্ডার নং" required>
      <input type="text" id="customerName" placeholder="কাস্টমার নাম" required>
      <input type="text" id="color" placeholder="কালার (অপশনাল)">
      <input type="number" id="quantity" placeholder="কন্টিটি (অপশনাল)">
      <input type="date" id="closeDate" placeholder="ক্লোজ তারিখ (অপশনাল)">
      <textarea id="comments" placeholder="মন্তব্য (অপশনাল)"></textarea>
      <button type="submit" id="submitBtn">শিডিউল যোগ করুন</button>
    </form>

    <div id="message" class="message"></div>

    <!-- টেবিল ভিউ -->
    <table id="scheduleTable">
      <thead>
        <tr>
          <th>শিডিউল তারিখ</th>
          <th>অর্ডার নং</th>
          <th>কাস্টমার নাম</th>
          <th>কালার</th>
          <th>কন্টিটি</th>
          <th>ক্লোজ তারিখ</th>
          <th>মন্তব্য</th>
          <th>একশন</th>
        </tr>
      </thead>
      <tbody>
        <!-- শিডিউল এন্ট্রি এখানে দেখানো হবে -->
      </tbody>
    </table>
  </div>

  <script>
    // Firebase configuration (আপনার প্রকল্প অনুযায়ী কনফিগারেশন পরিবর্তন করুন)
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCv7vvtIkbBD-8jKVetErI53SHG-AwnNaI",
  authDomain: "schedule-6daae.firebaseapp.com",
  projectId: "schedule-6daae",
  storageBucket: "schedule-6daae.firebasestorage.app",
  messagingSenderId: "163930511065",
  appId: "1:163930511065:web:2e6e1cb9a709955a1050c8",
  measurementId: "G-0KCNE3REKX"
};
    firebase.initializeApp(firebaseConfig);

    // Firebase Auth এবং Firestore instance
    const auth = firebase.auth();
    const db = firebase.firestore();

    // এডমিন যাচাই: (এই উদাহরণে, আমরা শুধু ক্লায়েন্ট সাইডে চেক করছি)
    auth.onAuthStateChanged(user => {
      if (user) {
        // উদাহরণস্বরূপ, যদি এডমিন ইমেইল "admin@example.com" হয়, তাহলে এডমিন হিসেবে ধরে নিচ্ছি।
        if (user.email !== "mohammadiaqub@gmail.com") {
          alert("আপনি এডমিন নন! এডমিন ড্যাশবোর্ডে প্রবেশের অনুমতি নেই।");
          window.location.href = "dashboard.html"; // সাধারন ইউজার পেজে রিডাইরেক্ট
        }
      } else {
        window.location.href = "index.html"; // লগইন না থাকলে লগইন পেজে রিডাইরেক্ট
      }
    });

    // লগআউট ফাংশন
    document.getElementById("logoutBtn").addEventListener("click", () => {
      auth.signOut().then(() => {
        window.location.href = "index.html";
      });
    });

    // ইউজারকে বার্তা দেখানোর ফাংশন
    function showMessage(msg, isError = false) {
      const messageDiv = document.getElementById("message");
      messageDiv.style.color = isError ? "red" : "green";
      messageDiv.textContent = msg;
      setTimeout(() => { messageDiv.textContent = ""; }, 4000);
    }

    // শিডিউল ফর্ম সাবমিশন (যোগ/আপডেট)
    document.getElementById("scheduleForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const scheduleDate = document.getElementById("scheduleDate").value;
      const orderNo = document.getElementById("orderNo").value;
      const customerName = document.getElementById("customerName").value;
      const color = document.getElementById("color").value;
      const quantity = document.getElementById("quantity").value;
      const closeDate = document.getElementById("closeDate").value;
      const comments = document.getElementById("comments").value;
      const timestamp = firebase.firestore.FieldValue.serverTimestamp();

      const scheduleData = { scheduleDate, orderNo, customerName, color, quantity, closeDate, comments, timestamp };

      const docId = document.getElementById("docId").value;
      if (docId) {
        // এডিট মোড: নির্দিষ্ট ডকুমেন্ট আপডেট
        db.collection("schedules").doc(docId).update(scheduleData)
          .then(() => {
            showMessage("শিডিউল আপডেট করা হয়েছে!");
            document.getElementById("scheduleForm").reset();
            document.getElementById("docId").value = "";
            document.getElementById("submitBtn").textContent = "শিডিউল যোগ করুন";
          })
          .catch(error => showMessage("ত্রুটি: " + error.message, true));
      } else {
        // নতুন এন্ট্রি যোগ করা
        db.collection("schedules").add(scheduleData)
          .then(() => {
            showMessage("শিডিউল যোগ করা হয়েছে!");
            document.getElementById("scheduleForm").reset();
          })
          .catch(error => showMessage("ত্রুটি: " + error.message, true));
      }
    });

    // শিডিউল এডিট
    function editSchedule(id) {
      db.collection("schedules").doc(id).get()
        .then(doc => {
          if (doc.exists) {
            const data = doc.data();
            document.getElementById("scheduleDate").value = data.scheduleDate || "";
            document.getElementById("orderNo").value = data.orderNo || "";
            document.getElementById("customerName").value = data.customerName || "";
            document.getElementById("color").value = data.color || "";
            document.getElementById("quantity").value = data.quantity || "";
            document.getElementById("closeDate").value = data.closeDate || "";
            document.getElementById("comments").value = data.comments || "";
            document.getElementById("docId").value = id;
            document.getElementById("submitBtn").textContent = "শিডিউল আপডেট করুন";
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }
        })
        .catch(error => showMessage("ত্রুটি: " + error.message, true));
    }

    // শিডিউল ডিলিট
    function deleteSchedule(id) {
      if (confirm("আপনি কি এই শিডিউলটি মুছে ফেলতে চান?")) {
        db.collection("schedules").doc(id).delete()
          .then(() => showMessage("শিডিউল মুছে ফেলা হয়েছে!"))
          .catch(error => showMessage("ত্রুটি: " + error.message, true));
      }
    }

    // রিয়েল-টাইম শিডিউল লোডিং (onSnapshot)
    function listenSchedules() {
      db.collection("schedules").orderBy("timestamp", "desc")
        .onSnapshot(snapshot => {
          const tableBody = document.querySelector("#scheduleTable tbody");
          tableBody.innerHTML = "";
          if (snapshot.empty) {
            tableBody.innerHTML = `<tr><td colspan="8" style="text-align:center;">কোনো রেকর্ড পাওয়া যায়নি</td></tr>`;
            return;
          }
          snapshot.forEach(doc => {
            const data = doc.data();
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${data.scheduleDate || ""}</td>
              <td>${data.orderNo || ""}</td>
              <td>${data.customerName || ""}</td>
              <td>${data.color || ""}</td>
              <td>${data.quantity || ""}</td>
              <td>${data.closeDate || ""}</td>
              <td>${data.comments || ""}</td>
              <td>
                <button onclick="editSchedule('${doc.id}')">এডিট</button>
                <button onclick="deleteSchedule('${doc.id}')">ডিলিট</button>
              </td>
            `;
            tableBody.appendChild(tr);
          });
        }, error => showMessage("ডাটা লোড করতে সমস্যা: " + error.message, true));
    }

    // পেজ লোডের সময় শিডিউল লোড
    listenSchedules();
  </script>
</body>
</html>
